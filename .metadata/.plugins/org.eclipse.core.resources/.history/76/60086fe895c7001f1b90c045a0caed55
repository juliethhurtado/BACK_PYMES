package co.edu.unicauca.sgph.reservatemporal.infrastructure.mapper;

import org.mapstruct.Mapper;
import org.mapstruct.Mapping;
import org.springframework.data.domain.Page;

import co.edu.unicauca.sgph.reservatemporal.domain.model.ReservaTemporal;
import co.edu.unicauca.sgph.reservatemporal.infrastructure.input.DTORequest.ReservaTemporalInDTO;
import co.edu.unicauca.sgph.reservatemporal.infrastructure.output.persistence.entity.ReservaTemporalEntity;

@Mapper(componentModel = "spring")
public interface ReservaTemporalRestMapper {

    // Mapeo explícito para evitar conflictos y manejar referencias nulas
    @Mapping(target = "identificacion", source = "numeroIdentificacion") // Mapea el número de identificación
    @Mapping(target = "idEspacioFisico", source = "espacioFisico.idEspacioFisico") // Mapea el ID del espacio físico
    @Mapping(target = "idUbicacion", expression = "java(entity.getEspacioFisico() != null && entity.getEspacioFisico().getUbicacion() != null ? entity.getEspacioFisico().getUbicacion().getIdUbicacion() : null)") // Manejo de nulos
    @Mapping(target = "salon", source = "espacioFisico.salon") // Mapea el salón
    @Mapping(target = "estado", expression = "java(entity.getEstado() != null ? entity.getEstado().getDescripcion() : null)") // Manejo de estado con expresión
    ReservaTemporal toReservaTemporal(ReservaTemporalEntity entity);

    // Mapea del modelo de dominio al DTO de entrada/salida
    ReservaTemporalInDTO toReservaTemporalInDTO(ReservaTemporal reservaTemporal);

    // Mapea una página de ReservaTemporal al DTO de entrada/salida
    default Page<ReservaTemporalInDTO> toPageReservaTemporalInDTO(Page<ReservaTemporal> reservas) {
        return reservas.map(this::toReservaTemporalInDTO);
    }
}
